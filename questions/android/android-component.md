# Android Components

### MustHave

<details>
<summary>[ac-1] Что такое Application, ApplicationContext, можно ли его где-то сохранять?
</summary>
Класс Application - это базовый класс приложения android. При запуске программы вначале создается экземпляр этого класса, при этом не важно какая именно точка входа в приложение использованна.

Application Context - также синглтон. Application Context создается при создании объекта Application
и живет, пока жив процесс приложения. По этой причине Application Context можно безопасно инжектить
в другие синглтоны в приложении

Activity Context - создается при создании активити и уничтожается вместе с активити. Контекст –
тяжелый объект. Когда говорят об утечке памяти в андроиде, имеют в виду утечку контекста, т.е.
ситуацию, когда контекст активити хранится после вызова Activity.onDestroy(). Не передавайте
контекст активити в другой объект, если не известно как долго этот объект проживет.
</details>
<details>
<summary>[ac-2] Какаие компоненты есть в Андроиде</summary>

Activity представляет UI и функциональность, видимые пользователю.

Service используется для исполнения долгих операций, которые не требуют взаимодействия с
пользователем.

BroadcastReceiver принимает и обрабатывает броадкаст ивенты, отправленные внутри приложения или из
других приложений.

ContentProvider используется для обмена данными с другими приложениями.
</details>
<details>
<summary>[ac-3] Что такое и зачем нужен манифест?</summary>

AndroidManifest.xml - это необходимый файл в любом проекте. Он определяет глобальные значения для
вашего пакета, в нем вы описываете, что находится внутри вашего приложения - деятельности, сервисы и
тд. Вы так же определяете, как все эти элементы взаимодействуют с Андроид. Например, какие виды
данных может перехватывать ваша программа. Должна ли она отображаться в главном меню вашего телефона
и тд. манифест приложения выполняет следующие задачи:

- Задаёт имя пакета Java для приложения. Имя пакета служит уникальным идентификатором для
  приложения.

- Описывает компоненты приложения (активности, службы, широковещательные приёмники и
  контент-провайдеры), из которых состоит приложение. Он содержит названия классов, которые
  реализуют каждый из компонентов, и задаёт им различные свойства (например, какие интенты они могут
  обрабатывать). Эти объявления позволяют Android знать, какие компоненты и при каких условиях могут
  быть запущены.

- Определяет, в каких процессах будут размещаться компоненты приложения.

- Объявляет, каких разрешения должно иметь приложение для доступа к защищенным частям API и
  взаимодействия с другими приложениями.

- Перечисляет классы Instrumentation, которые предоставляют профилирование и другую информацию во
  время работы приложения. Эти объявления присутствуют в манифестве только тогда, когда приложение
  находится на стадии разработки и отладки, и удаляются перед публикацией.

- Объявляет минимальный уровень API, который требуется приложению.

- Перечисляет библиотеки, с которыми приложение должно быть связано.

Файл манифеста также указывает метаданные приложения, которые включают в себя иконку, номер версии,
темы и так далее.

Также можно указать, куда должно устанавливаться приложение: на SD-карту или внутреннюю память,
используя атрибут android:installLocation.
</details>

<details>
<summary>[ac-4] Какой жизненный цикл Activity? Что происходит с жизненным циклом при стартеновой Activity?</summary>

![image](https://metanit.com/java/android/pics/life_cycle.png)

[документация](https://developer.android.com/guide/components/activities/activity-lifecycle)
</details>

<details>
<summary>[ac-5] Что такое Fragment?</summary>

Фрагмент представляет собой многократно используемую часть UI вашего приложения.

Фрагмент имеет свой собственный layout, имеет собственный жизненный цикл и может обрабатывать свои
собственные входные события.

Фрагменты не могут жить сами по себе — они должны размещаться в активити или другом фрагменте.
</details>
<details>
<summary>[ac-6] Какие есть отличия от жизненного цикла Activity?</summary>

![image](https://developer.android.com/images/guide/fragments/fragment-view-lifecycle.png)

В отличии от активити у фрагмента есть методы

onAttach(Activity) - вызывается перед onCreate(), вызывается когда фрагмент прикреплен к активити

onCreateView() и onViewCreated(). Первый создает View а второй вызывается когда view созданна.

onActivityCreated(Bundle) - вызывается когда активити завешил собственный onCreate

onViewStateRestored - вызывается при востановлении состояния фрагмента
</details>

### Лишним не будет

<details>
<summary>[ac-7] Виды Intent, чем отличаются. Что такое PendingIntent?</summary>
Intent могут быть явные - например когда мы указываем класс конкретной активити которую нужно открыть.

и неявные, когда в интент записываются action, data, category. И Система подбирает подходящую для
открытия активити.

Предоставляя PendingIntent другому приложению, вы предоставляете ему право выполнять указанную вами
операцию, как если бы это другое приложение было вами (с теми же разрешениями и идентификатором).
Таким образом, вы должны быть осторожны с тем, как вы создаете PendingIntent: почти всегда,
например, базовое намерение, которое вы предоставляете, должно иметь имя компонента, явно
установленное для одного из ваших собственных компонентов, чтобы гарантировать, что в конечном итоге
он будет отправлен туда и никуда больше.

Например PendingIntent используется для передачи в нотификации, чтобы дать им открывать активити
нашего приложения.
</details>

<details>
<summary>[ac-8] Какие компоненты обязательно указывать в манифесте, на что это влияет?</summary>

Activity и ContentProvider обязательно должны быть указаны в манифесте.

Service и BroadcastReceiver можно запустить не указывая в манифесте, однако

для BroadcastReceiver нам нужно будет самим завершить его работу когда он будет более не нужен.

для Service - без указания в манифесете у приложения не будет повышеного приоритета при нехватки
памяти, а следовательно увеличивается вероятность что его выгрузят из памяти.
</details>

<details>
<summary>[ac-9] ОС Андроид гарантирует вызов коллбэка onDestroy()? В каких кейсах он не будет вызван?</summary>
</details>

<details>
<summary>[ac-10] Что происходит при нехватке памяти в системе?</summary>

При нехватки памяти система начинает убивать приложения, начиная с тех которые имеют наименьший
приоритет.

При этом экземпляры активити этих приложений будут уничтожены, но у них будет сохранено состояние
для дальнейшего востановления

</details>
<details>
<summary>[ac-11] Подход Single Activity что это? Когда необходимо создавать отдельную Activity? Когда он используется и для чего?</summary>

Запуск активити в андроиде - ассинхронный процесс. Мы не можем его полностью контролировать. В связи
с жизненным циклом активити, если каждый экран - отдельное активити то жизненный цикл приложения
получается весьма сложным.

Если у нас сингл активити - жизненный цикл активити и приложения - становится одинаковым (про
сервисы пока не говорим)

Мы можем полностью контролировать переходы между экранами, добавить любые анимации. Посмотреть на
бэкстек экранов, с активити все сложнее так как различные флаги к их запуску можно добавить в разных
местах

Изменение конфигурации налету - если мы решим например поменять локаль внутри приложания, то при
множественных активити это будет не так просто.В Single-Activity приложении достаточно изменить
установленную локаль в контексте приложения и вызвать recreate() у Activity, остальное система
сделает все сама.

[Статья](https://habr.com/ru/company/redmadrobot/blog/426617)
</details>

<details>
<summary>[ac-12] Какие бывают сервисы? Как их запускать?</summary>

Сервисы бывают Foreground и Background. Foreground сервис явно указывает пользователю что он
запущен, например сервис плеера для прослушивания музыки. Background сервис может использоваться для
скачивания файлов, или других действий скрытых от пользователя, он имеет некоторые ограничения по
сравнению с Foreground сервисами.

Service и BroadcastReceiver можно запустить не указывая в манифесте,

для Service - без указания в манифесете у приложения не будет повышеного приоритета при нехватки
памяти, а следовательно увеличивается вероятность что его выгрузят из памяти.

Сервис можно запустить двумя способами, через bind или через старт

В первом случае сервис закончит работу когда от него отпишутся все подписчики, во втором сервис
продолжит работу не зависимо от наличия подписчиков, о его завершении нам нужно позаботиться самим.

</details>

<details>
<summary>[ac-13] Как происходит коммуникация с сервисом?</summary>

Для взаимодействия можно кидать интенты, можно написать eventBus, можно использовать
Messenger</details>

<details>
<summary>[ac-14] Ограничения бродкаст ресивера</summary>

1. Ограниченное время выполнения onReceive()

2. При спаме сообщений часть из них может потеряться

Начиная с Android 8 часть неявных (implicit) широковещательных сообщений, задаваемых через манифест,
запретили. Теперь нужно регистрировать их программно

</details>

<details>
<summary>[ac-15] Что происходит при изменении конфигурации?</summary>
Активити пересоздается, после чего она пересоздает фрагменты внутри себя. При этом использую сохраненное в SavedInstanceState состояние.
</details>
<details>
<summary>[ac-16] Если активность пересоздается - восстанавливается ли содержимое фрагмента?</summary>
Да, восстанавливается.
</details>

### Нюансы

<details>
<summary>[ac-17] Как из сервиса запустить активити?</summary>

Eсли вы запускаете Activity в сервисе, вы должны добавить флаг FLAG_ACTIVITY_NEW_TASK

У сервиса и активити разные контексты. При запуске Activity из Service получим активити без темы. (
нужно проверить)

</details>

<details>
<summary>[ac-18] смена конфигурации, зачем может потребоваться сохранять SavedInstanceState

Смена конфигурации происходит при смене языка, при повороте экрана, изменении размера окна.

Если в Activity или в Fragment присутствуют данные, которые должны существовать на протяжении
долгого времени, их стоит привязать к сроку жизни активности, переопределяя метод
onSaveInstanceState(Bundle) для сохранения состояния и его последующего восстановления.

</summary></details>

<details>
<summary>[ac-19] Как выполняется добавление Fragment'а на экран?</summary>

Для добавления фрагмента на экран используется FragmentManager. Нужно создать новую транзакцию,
указать ей какой фрагмент, в какой контейнер, и как встаить (add или replace).

Опционально можно добавить анимацию.

После чего вызвать у транзацкии метод commit для ее старта.
</details>